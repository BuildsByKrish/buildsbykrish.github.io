<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Movie Recommendations | Krish Vault</title>
  
  <!-- Poppins (General Text), Bebas Neue (Headers), Orbitron (Techy/Neon) -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&family=Bebas+Neue&family=Orbitron:wght@400;700&display=swap" rel="stylesheet" />

  <style>
    /* New Neon Dark Theme Variables */
    :root {
      --primary-neon: #00eaff;
      --secondary-neon: #ff00c8;
      --dark-bg: #0a0a0e;
      --card-bg: rgba(18, 18, 22, 0.7);
      --card-border: rgba(0, 234, 255, 0.2);
      --text-color: #f0f0f0;
      --glow-shadow: 0 0 10px var(--primary-neon);
      --input-focus: #ff00c8;
      --must-watch-color: #ffc107;
      --hindi-dubbed-color: #28a745;
      --hover-color: #00eaff;
    }
    
    body {
      font-family: 'Poppins', sans-serif;
      background-color: var(--dark-bg);
      color: var(--text-color);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
      position: relative;
      overflow-x: hidden;
    }

    /* Background Particles */
    .particle {
        position: fixed;
        background-color: var(--primary-neon);
        border-radius: 50%;
        box-shadow: 0 0 5px var(--primary-neon);
        opacity: 0.5;
        pointer-events: none;
        z-index: 0;
        animation: float-up linear infinite;
    }

    @keyframes float-up {
        0% { transform: translateY(100vh) scale(0.5); opacity: 0; }
        50% { opacity: 0.8; }
        100% { transform: translateY(-10vh) scale(1.2); opacity: 0; }
    }

    /* Header and Main Content Styling */
    .container {
      width: 100%;
      max-width: 1200px;
      padding: 20px;
      z-index: 1; /* Keep content above particles */
    }

    h1 {
      font-family: 'Orbitron', sans-serif;
      font-weight: 700;
      font-size: 2.5rem;
      color: var(--primary-neon);
      text-align: center;
      margin-bottom: 20px;
      text-shadow: var(--glow-shadow);
      letter-spacing: 2px;
    }

    .subtitle {
      text-align: center;
      color: var(--text-color);
      margin-bottom: 40px;
      font-size: 1.1rem;
      opacity: 0.8;
    }

    /* Back Button Style */
    .back-link {
        display: block;
        margin: 0 auto 30px auto;
        width: fit-content;
        padding: 10px 20px;
        background-color: var(--secondary-neon);
        color: var(--dark-bg);
        text-decoration: none;
        font-family: 'Bebas Neue', sans-serif;
        letter-spacing: 1px;
        border-radius: 8px;
        transition: background-color 0.3s, box-shadow 0.3s;
        text-shadow: none;
        font-size: 1.1rem;
        box-shadow: 0 0 15px rgba(255, 0, 200, 0.5);
    }
    .back-link:hover {
        background-color: #ff33d4;
        box-shadow: 0 0 25px rgba(255, 0, 200, 1);
    }

    /* Filter Bar */
    .filter-bar {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      margin-bottom: 30px;
      padding: 15px;
      background: var(--card-bg);
      border-radius: 10px;
      border: 1px solid var(--card-border);
      box-shadow: 0 0 5px var(--card-border);
    }

    .filter-bar input,
    .filter-bar select {
      flex: 1;
      min-width: 150px;
      padding: 10px;
      border: 1px solid var(--card-border);
      border-radius: 6px;
      background-color: #1a1a20;
      color: var(--text-color);
      transition: border-color 0.3s, box-shadow 0.3s;
    }

    .filter-bar input:focus,
    .filter-bar select:focus {
      outline: none;
      border-color: var(--input-focus);
      box-shadow: 0 0 8px var(--input-focus);
    }

    /* Watchlist Card Grid */
    #vaultContainer {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 25px;
    }

    .vault-card {
      background: var(--card-bg);
      border: 2px solid var(--card-border);
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 0 10px rgba(0, 234, 255, 0.1);
      transition: transform 0.3s, box-shadow 0.3s;
      position: relative;
      overflow: hidden;
    }

    .vault-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 0 20px var(--hover-color), 0 0 30px rgba(0, 234, 255, 0.3);
    }

    .vault-card h2 {
      font-family: 'Bebas Neue', sans-serif;
      font-size: 1.8rem;
      color: var(--primary-neon);
      margin-bottom: 10px;
      letter-spacing: 1px;
    }

    .vault-card .id {
      font-family: 'Orbitron', sans-serif;
      font-size: 1.2rem;
      color: var(--secondary-neon);
      margin-right: 5px;
    }

    .info-line {
      font-size: 0.9rem;
      margin-bottom: 4px;
      color: #b0b0b0;
    }

    .info-line span {
      font-weight: 600;
      color: var(--text-color);
      margin-right: 5px;
    }

    .description {
      font-size: 0.9rem;
      margin-top: 15px;
      padding-top: 10px;
      border-top: 1px dashed rgba(255, 255, 255, 0.1);
      line-height: 1.5;
      color: #cccccc;
    }

    /* Poster and card inner layout */
    .card-inner {
      display: flex;
      gap: 12px;
      align-items: flex-start;
    }
    .poster-wrap {
      flex: 0 0 140px;
      max-width: 140px;
    }
    .poster-img {
      width: 100%;
      height: auto;
      display: block;
      border-radius: 8px;
      object-fit: cover;
      box-shadow: 0 6px 18px rgba(0,0,0,0.6);
      border: 1px solid rgba(255,255,255,0.03);
      background: #111;
    }
    .poster-placeholder {
      width: 100%;
      height: 200px;
      border-radius: 8px;
      background: linear-gradient(135deg,#111 0%, #222 100%);
      color: #888;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:0.85rem;
      border: 1px solid rgba(255,255,255,0.03);
    }
    .card-details { flex: 1 1 auto; }

    /* Badges */
    .badges {
      margin-top: 15px;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .badge {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 4px;
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
    }

    .must-watch-badge {
      background-color: var(--must-watch-color);
      color: #333;
      box-shadow: 0 0 8px rgba(255, 193, 7, 0.7);
    }

    .hindi-dubbed-badge {
      background-color: var(--hindi-dubbed-color);
      color: white;
    }

    .tag-list {
      margin-top: 10px;
      font-size: 0.8rem;
      color: var(--primary-neon);
      opacity: 0.7;
      font-style: italic;
    }
    
    .no-results {
        text-align: center;
        width: 100%;
        grid-column: 1 / -1;
        font-size: 1.2rem;
        color: var(--secondary-neon);
        margin-top: 50px;
        padding: 20px;
        border: 1px dashed var(--secondary-neon);
        border-radius: 8px;
    }

    /* Media Queries for Responsiveness */
    @media (max-width: 768px) {
      h1 {
        font-size: 2rem;
      }
      .card-inner { flex-direction: column; }
      .poster-wrap { flex: 0 0 auto; max-width: 100%; }
      .filter-bar {
        flex-direction: column;
        gap: 10px;
      }
      #vaultContainer {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <!-- Particle Generation Script (same as index.html) -->
  <script>
    function createParticle() {
      const particle = document.createElement('div');
      particle.classList.add('particle');
      particle.style.width = Math.random() * 3 + 1 + 'px';
      particle.style.height = particle.style.width;
      particle.style.left = Math.random() * 100 + 'vw';
      particle.style.animationDuration = Math.random() * 20 + 10 + 's';
      particle.style.animationDelay = Math.random() * 5 + 's';
      document.body.appendChild(particle);
    }

    document.addEventListener("DOMContentLoaded", () => {
      for (let i = 0; i < 30; i++) {
        createParticle();
      }
    });
  </script>
  
  <!-- Link to the data files: movie.js contains recommendations; data.js contains the broader watchlist. -->
  <script src="./movie.js"></script>
  <script src="./data.js"></script>

  <div class="container">
    <a href="./index.html" class="back-link">‚Üê Go Back to Main Hub</a>
    
    <h1>üé¨ Movie Recommendations Vault</h1>
    <p class="subtitle">A curated list of must-watch movies (non-series) recommended for you.</p>

    <!-- Filter Bar -->
    <div class="filter-bar">
      <input type="text" id="searchInput" placeholder="Search by title, genre, or tag..." onkeyup="applyFilters()" />
      <select id="yearFilter" onchange="applyFilters()">
        <option value="">All Years</option>
      </select>
      <select id="platformFilter" onchange="applyFilters()">
        <option value="">All Platforms</option>
      </select>
      <select id="ratingFilter" onchange="applyFilters()">
        <option value="">All Ratings</option>
        <option value="8.0">IMDb 8.0+</option>
        <option value="7.5">IMDb 7.5+</option>
      </select>
      <select id="mustWatchFilter" onchange="applyFilters()">
        <option value="">All Statuses</option>
        <option value="true">Must Watch</option>
      </select>
    </div>

    <!-- Watchlist Grid Container -->
    <div id="vaultContainer">
      <!-- Movie cards will be rendered here by JavaScript -->
      <p class="no-results" style="grid-column: 1 / -1; display: none;">Loading movie data...</p>
    </div>
  </div>

  <script>
    let movieData = [];
    
  document.addEventListener('DOMContentLoaded', () => {
    // Accept data from either movie.js (window.movieRecommendations)
    // or data.js (window.myWatchlist). Prefer movieRecommendations when present.
    const srcRecommendations = window.movieRecommendations;
    const srcWatchlist = window.myWatchlist;

    if (Array.isArray(srcRecommendations) && srcRecommendations.length > 0) {
      movieData = srcRecommendations.slice();
    } else if (Array.isArray(srcWatchlist) && srcWatchlist.length > 0) {
      // data.js doesn't tag movies explicitly; treat items without 'seasons' as movies
      movieData = srcWatchlist.filter(item => !item.seasons && !item.episodes);
    } else {
      console.error('Error: No movie data found. Ensure movie.js or data.js is loaded and defines the expected arrays.');
      document.getElementById('vaultContainer').innerHTML = '<p class="no-results" style="color: red;">Failed to load data.</p>';
      return;
    }

    // 2. Initialize filter options (Years and Platforms)
    initializeFilters(movieData);

    // 3. Initial render
    applyFilters();
  });

    // Helper function to dynamically populate dropdowns
    function initializeFilters(data) {
        const years = new Set();
        const platforms = new Set();

        data.forEach(item => {
            if (item.year) years.add(item.year);
            if (item.platform) platforms.add(item.platform);
        });

        const yearFilter = document.getElementById('yearFilter');
        Array.from(years).sort((a, b) => b - a).forEach(year => {
            yearFilter.innerHTML += `<option value="${year}">${year}</option>`;
        });

        const platformFilter = document.getElementById('platformFilter');
        Array.from(platforms).sort().forEach(platform => {
            platformFilter.innerHTML += `<option value="${platform}">${platform}</option>`;
        });
    }

    // Main filtering and rendering function
    function applyFilters() {
      const searchTerm = document.getElementById('searchInput').value.toLowerCase();
      const year = document.getElementById('yearFilter').value;
      const platform = document.getElementById('platformFilter').value;
      const minRating = parseFloat(document.getElementById('ratingFilter').value);
      const mustWatch = document.getElementById('mustWatchFilter').value;
      
      let filteredList = movieData.filter(item => {
        // Search Term Filter (Title, Genre, Tags)
        const matchesSearch = item.title.toLowerCase().includes(searchTerm) ||
                              item.genre.toLowerCase().includes(searchTerm) ||
                              (item.tags && item.tags.some(tag => tag.toLowerCase().includes(searchTerm)));

        // Year Filter
        const matchesYear = !year || item.year.toString() === year;

        // Platform Filter
        const matchesPlatform = !platform || item.platform === platform;

        // Rating Filter
        const matchesRating = !minRating || (item.imdbRating && item.imdbRating >= minRating);

        // Must Watch Filter
        const matchesMustWatch = !mustWatch || item.mustWatch.toString() === mustWatch;

        return matchesSearch && matchesYear && matchesPlatform && matchesRating && matchesMustWatch;
      });

      renderWatchlist(filteredList);
    }

    // Function to draw the cards on the screen
    function renderWatchlist(list) {
      const container = document.getElementById('vaultContainer');
      container.innerHTML = ''; // Clear previous results

      if (list.length === 0) {
        container.innerHTML = '<p class="no-results">No movies match your filters.</p>';
        return;
      }

      list.forEach((item, index) => {
        const card = document.createElement('div');
        card.className = 'vault-card';
        
        // Tags display
        const tagsHtml = item.tags && item.tags.length > 0 
          ? `<p class="tag-list">#${item.tags.join(' #')}</p>`
          : '';

        // Poster HTML (lazy load). Provide a simple fallback when posterUrl is missing.
        const posterHtml = item.posterUrl
          ? `<img class="poster-img" src="${item.posterUrl}" alt="${(item.title||'movie').replace(/"/g,'&quot;')} poster" loading="lazy">`
          : `<div class="poster-placeholder">No Image</div>`;

        // Movie-specific details with a two-column layout (poster + details)
        card.innerHTML = `
          <div class="card-inner">
            <div class="poster-wrap">${posterHtml}</div>
            <div class="card-details">
              <h2><span class="id">${index + 1}.</span> ${item.title}</h2>
              <p class="info-line"><span>Year:</span> ${item.year || 'N/A'}</p>
              <p class="info-line"><span>Genre:</span> ${item.genre || 'N/A'}</p>
              <p class="info-line"><span>IMDb Rating:</span> ${item.imdbRating || 'N/A'}</p>
              <p class="info-line"><span>Platform:</span> ${item.platform || 'N/A'}</p>
              <p class="info-line"><span>Runtime:</span> ${item.runtime || 'N/A'}</p>
              <div class="badges">
                <span class="badge must-watch-badge" style="display: ${item.mustWatch ? 'inline-block' : 'none'};">Must Watch</span>
                <span class="badge hindi-dubbed-badge" style="display: ${item.hindiDubbed ? 'inline-block' : 'none'};">Hindi Dubbed</span>
              </div>
              <p class="description">${item.description}</p>
              ${tagsHtml}
            </div>
          </div>
        `;
        container.appendChild(card);
      });
    }
  </script>
</body>
</html>
